"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5436],{5436:(b,g,o)=>{o.r(g),o.d(g,{OrdersModule:()=>w});var y=o(9808),p=o(2340),t=o(5e3),T=o(520);let h=(()=>{class n{constructor(e){this.http=e}get WindowRef(){return window}createOrder(e){return this.http.post(`${p.N.apiUrl}/order/create`,e)}verifyAndCapturePayment(e){return this.http.post(`${p.N.apiUrl}/order/verify`,e)}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(T.eN))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var m=o(6696),d=o(655),a=o(3075),Z=o(5439),R=o(3453),f=o(9224),O=o(7423),v=o(7322),I=o(7531);function A(n,r){if(1&n&&(t.TgZ(0,"form",4),t.TgZ(1,"mat-form-field",5),t.TgZ(2,"mat-label"),t._uU(3,"Organization Id"),t.qZA(),t._UZ(4,"input",6),t.qZA(),t.TgZ(5,"mat-form-field",7),t.TgZ(6,"mat-label"),t._uU(7,"Base Price"),t.qZA(),t._UZ(8,"input",8),t.qZA(),t.TgZ(9,"mat-form-field",7),t.TgZ(10,"mat-label"),t._uU(11,"Discount %"),t.qZA(),t._UZ(12,"input",9),t.qZA(),t.TgZ(13,"mat-form-field",7),t.TgZ(14,"mat-label"),t._uU(15,"Seats Required"),t.qZA(),t._UZ(16,"input",10),t.qZA(),t.TgZ(17,"mat-form-field",7),t.TgZ(18,"mat-label"),t._uU(19,"Months"),t.qZA(),t._UZ(20,"input",11),t.qZA(),t.TgZ(21,"mat-form-field",7),t.TgZ(22,"mat-label"),t._uU(23,"Total"),t.qZA(),t._UZ(24,"input",12),t.qZA(),t.qZA()),2&n){const e=t.oxw();t.Q6J("formGroup",e.activationForm)}}let z=(()=>{class n{constructor(e,i,l,s){this.fb=e,this.orderService=i,this.organizationService=l,this.router=s,this.perUserRate=new a.NI(500,[]),this.discount=new a.NI(10,[a.kI.required]),this.seats=new a.NI(5,[a.kI.required]),this.total=new a.NI({value:0,disabled:!0},[a.kI.required]),this.months=new a.NI(1,[a.kI.required]),this.organization=new a.NI({value:"",disabled:!0},[a.kI.required])}addUserQuota(){this.organizationService.updateOrganizationQuota(this.activationForm.getRawValue()).subscribe(e=>{console.log(e)},e=>{console.log(e)})}ngOnInit(){return(0,d.mG)(this,void 0,void 0,function*(){this.data=yield this.organizationService.getCurrentOrganization().toPromise(),this.initActivationForm()})}initActivationForm(){this.organization.setValue(this.data._id),this.calculateTotalPrice(),this.organization.setValue(this.data._id),this.activationForm=this.fb.group({organization:this.organization,perUserRate:this.perUserRate,discount:this.discount,seats:this.seats,total:this.total,months:this.months}),this.perUserRate.valueChanges.subscribe(e=>{this.calculateTotalPrice()}),this.discount.valueChanges.subscribe(e=>{this.calculateTotalPrice()}),this.seats.valueChanges.subscribe(e=>{this.calculateTotalPrice()}),this.months.valueChanges.subscribe(e=>{console.log(Z().add(e,"M")),this.calculateTotalPrice()})}handleActivationFormSubmit(){return(0,d.mG)(this,void 0,void 0,function*(){const e=yield this.orderService.createOrder({amount:100*this.total.value,currency:"INR",notes:this.activationForm.value}).toPromise();this.router.navigate(["orders","payment",e.id],{queryParams:e})})}calculateTotalPrice(){this.total.setValue(this.perUserRate.value*(1-.01*this.discount.value)*this.seats.value*this.months.value)}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(a.qu),t.Y36(h),t.Y36(R.M),t.Y36(m.F0))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-orders"]],decls:8,vars:1,consts:[[2,"height","100vh"],[2,"font-weight","600","font-size","larger","margin-bottom","30px"],[3,"formGroup",4,"ngIf"],["type","submit","mat-raised-button","","color","primary",1,"mat-full-width",3,"click"],[3,"formGroup"],["appearance","outline",1,"mat-full-width",2,"display","none"],["matInput","","formControlName","organization"],["appearance","outline",1,"mat-full-width"],["matInput","","formControlName","perUserRate"],["matInput","","formControlName","discount","type","number","step","1"],["matInput","","formControlName","seats","type","number","step","1"],["matInput","","formControlName","months","type","number","step","1"],["matInput","","formControlName","total"]],template:function(e,i){1&e&&(t.TgZ(0,"mat-card",0),t.TgZ(1,"mat-card-content"),t.TgZ(2,"p",1),t._uU(3,"Place Order"),t.qZA(),t.YNc(4,A,25,1,"form",2),t.qZA(),t.TgZ(5,"mat-card-footer"),t.TgZ(6,"button",3),t.NdJ("click",function(){return i.handleActivationFormSubmit()}),t._uU(7,"Proceed to checkout"),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(4),t.Q6J("ngIf",i.activationForm))},directives:[f.a8,f.dn,y.O5,f.rt,O.lW,a._Y,a.JL,a.sg,v.KE,v.hX,I.Nt,a.Fj,a.JJ,a.u,a.wV],styles:[".full-screen-modal[_ngcontent-%COMP%]   .mat-dialog-container[_ngcontent-%COMP%]{max-width:none}"]}),n})();var u=(()=>{return(n=u||(u={})).OK="OK",n.INVALID="INVALID",u;var n})();class P{constructor(r){this.ngZone=r,this.SCRIPT_ID="rzp-js-sdk"}injectRZPScript(){if(this.scriptElement=document.getElementById(this.SCRIPT_ID),this.scriptElement)return;this.scriptElement=document.createElement("script"),this.scriptElement.id=this.SCRIPT_ID;const r=new Promise((e,i)=>{this.scriptElement.onload=()=>{this.ngZone.run(()=>{e(!0)})},this.scriptElement.onerror=()=>{this.ngZone.run(()=>{i({code:0,description:"Network error"})})}});return this.scriptElement.src="https://checkout.razorpay.com/v1/checkout.js",document.head.appendChild(this.scriptElement),r}openRZP(r){r.modal=r.modal||{};const e=new Promise((l,s)=>{r.modal.ondismiss=()=>{this.ngZone.run(()=>{s({code:2,description:"Payment cancelled by user"})})},r.handler=c=>{this.ngZone.run(()=>{l(c)})},r.external&&r.external.wallets&&r.external.wallets.length&&(r.external.handler=c=>{c.external_wallet_name=c.wallet,this.ngZone.run(()=>{s(c)})})});return new(0,window.Razorpay)(r).open(),e}open(r){return(0,d.mG)(this,void 0,void 0,function*(){return window.Razorpay||(yield this.injectRZPScript()),yield this.openRZP(r)})}}var C=o(7261);const U=[{path:"payment/:order_id",component:(()=>{class n{constructor(e,i,l,s){this.ngZone=e,this.activatedRoute=i,this.orderService=l,this.snack=s}ngOnInit(){this.createdOrder=this.activatedRoute.snapshot.queryParams,this.init()}init(){return(0,d.mG)(this,void 0,void 0,function*(){const e=new P(this.ngZone),i=this.activatedRoute.snapshot.paramMap.get("order_id"),l={description:"Payment for applesaucesystem crm",key:p.N.razorPayKey,order_id:i,amount:this.createdOrder.amount,name:"Shanur Rahman",prefill:{email:"shanur@applesaucecrm.com",contact:"+919199946568",name:"AppleSauce Systems"}};try{const s=yield e.open(l),c=yield this.orderService.verifyAndCapturePayment(s).toPromise();c.status===u.OK?this.snack.open("Payment Successful, routing to lead page","cancel"):c.status===u.INVALID?this.snack.open("Payment failed, please try different payment method","cancel"):this.snack.open("Something went wrong")}catch(s){console.error(s)}})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(t.R0b),t.Y36(m.gz),t.Y36(h),t.Y36(C.ux))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-orders"]],decls:0,vars:0,template:function(e,i){},encapsulation:2}),n})(),pathMatch:"full"},{path:"placeOrder",component:z,pathMatch:"full"}];let N=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[m.Bz.forChild(U)],m.Bz]}),n})();var S=o(9661);let w=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({providers:[h],imports:[[y.ez,N,S.O,a.u5,a.UX]]}),n})()}}]);